<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Aroma el lagom dives · 고객 상담 차트</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 앱 아이콘 & PWA 설정 -->
    <link rel="icon" href="./roblecoco_icon_192.png" />
    <link rel="apple-touch-icon" href="./roblecoco_icon_512.png" />
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#000000" />

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Spoqa Han Sans Neo",
          "Apple SD Gothic Neo", system-ui, sans-serif;
        background: #f4ede3;
        color: #2b2215;
      }

      .app-shell {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 18px 60px;
      }

      .title {
        font-size: 30px;
        letter-spacing: 0.06em;
        margin: 0;
      }

      .subtitle {
        margin-top: 8px;
        opacity: 0.75;
      }

      .top-bar {
        margin-top: 18px;
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .brand-pill {
        background: #1f1b16;
        color: #f7f1e7;
        padding: 8px 14px;
        border-radius: 999px;
        font-weight: 700;
        letter-spacing: 0.08em;
        font-size: 14px;
      }

      .pill {
        background: #fff9f0;
        border: 1px solid rgba(43, 34, 21, 0.18);
        padding: 8px 14px;
        border-radius: 999px;
        font-size: 14px;
      }

      .layout {
        margin-top: 18px;
        display: grid;
        grid-template-columns: 1.15fr 0.85fr;
        gap: 16px;
      }

      @media (max-width: 960px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: #fff;
        border: 1px solid rgba(43, 34, 21, 0.18);
        border-radius: 22px;
        padding: 18px;
        box-shadow: 0 14px 32px rgba(0, 0, 0, 0.05);
      }

      .card-title {
        font-weight: 800;
        letter-spacing: 0.08em;
        font-size: 18px;
      }

      .card-caption {
        margin-top: 6px;
        opacity: 0.7;
        font-size: 13px;
      }

      .grid2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      @media (max-width: 720px) {
        .grid2 {
          grid-template-columns: 1fr;
        }
      }

      label {
        display: block;
        font-size: 13px;
        font-weight: 700;
        margin-bottom: 6px;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 12px;
        border-radius: 14px;
        border: 1px solid rgba(43, 34, 21, 0.22);
        background: #fffdf8;
        outline: none;
        font-size: 15px;
      }

      textarea {
        min-height: 84px;
        resize: vertical;
      }

      .muted {
        opacity: 0.75;
        font-size: 13px;
      }

      .section-title {
        margin-top: 16px;
        font-weight: 900;
        font-size: 16px;
      }

      .divider {
        margin: 14px 0;
        border-top: 1px dashed rgba(43, 34, 21, 0.24);
      }

      .tagbox {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 8px;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 999px;
        border: 1px dashed rgba(43, 34, 21, 0.22);
        background: #fff7ef;
        font-size: 14px;
      }

      .tag input {
        width: 18px;
        height: 18px;
      }

      .tag.green {
        background: #eff9f1;
        border-color: rgba(35, 105, 55, 0.25);
      }

      .tag.red {
        background: #fff1f1;
        border-color: rgba(155, 35, 35, 0.25);
      }

      .helper-box {
        background: #fff7ea;
        border: 1px dashed rgba(43, 34, 21, 0.18);
        padding: 12px 14px;
        border-radius: 14px;
        font-size: 13px;
        margin-top: 10px;
      }

      .btn-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 14px;
      }

      .btn {
        padding: 12px 16px;
        border-radius: 999px;
        border: 1px solid rgba(43, 34, 21, 0.22);
        background: #fff;
        cursor: pointer;
        font-weight: 800;
        letter-spacing: 0.02em;
      }

      .btn-primary {
        background: #1f1b16;
        color: #f7f1e7;
        border-color: transparent;
      }

      .btn-outline {
        background: #fffdf8;
      }

      .card-header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .photo-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 720px) {
        .photo-grid {
          grid-template-columns: 1fr;
        }
      }

      .photo-box {
        border: 1px dashed rgba(43, 34, 21, 0.22);
        border-radius: 14px;
        background: #fffdf8;
        padding: 10px;
      }

      .photo-preview {
        margin-top: 10px;
        height: 160px;
        border-radius: 14px;
        background: #faf2e7;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(43, 34, 21, 0.55);
        font-weight: 700;
      }
    </style>
  </head>

  <body>
    <div class="app-shell">
      <h1 class="title">Client Care Chart</h1>
      <div class="subtitle">
        Aroma el lagom dives · 1:1 Private Aromatherapy & Bamboo Therapy
      </div>

      <div class="top-bar">
        <div class="brand-pill">AROMA EL LAGOM DIVES</div>
        <div class="pill">오늘 상담일자 : <span id="todayDate">0000-00-00</span></div>
        <div style="flex:1"></div>
        <div class="pill">PC · 모바일 동시 사용</div>
        <div class="pill">Firebase Sync</div>
        <div class="pill">로블코코 · 엘라곰 제품 연동</div>
      </div>

      <div class="layout">
        <!-- LEFT COLUMN -->
        <div>
          <div class="card">
            <div class="card-title">01. CLIENT PROFILE</div>
            <div class="card-caption">고객 기본 정보 · 체질 · 주의사항 · 오늘 컨디션</div>

            <div class="divider"></div>

            <div class="grid2">
              <div>
                <label>고객 이름 *</label>
                <input id="clientName" placeholder="예) 노연업" />
              </div>

              <div>
                <label>연락처(핸드폰) *</label>
                <input id="clientPhone" placeholder="예) 010-0000-0000" />
              </div>

              <div>
                <label>연령대</label>
                <select id="ageRangeSelect">
                  <option value="">선택</option>
                  <option value="10대">10대</option>
                  <option value="20대">20대</option>
                  <option value="30대">30대</option>
                  <option value="40대">40대</option>
                  <option value="50대">50대</option>
                  <option value="60대+">60대+</option>
                </select>
              </div>

              <div>
                <label>체질 · 특이사항</label>
                <input id="clientConstitution" placeholder="예) 유방암, 자궁암 수술 항암중" />
              </div>
            </div>

            <div style="margin-top: 12px">
              <label>CLIENT NOTE</label>
              <textarea id="clientNote" placeholder="고객 메모"></textarea>
            </div>

            <div class="divider"></div>

            <div class="grid2">
              <div>
                <label>고객 검색(전화번호 또는 이름)</label>
                <input id="searchKeyword" placeholder="예) 01067003784 또는 노연업" />
                <button class="btn btn-outline" onclick="searchClient()">고객 검색</button>
              </div>
            </div>

            <div class="section-title">주의해야 할 상황 · Contra-indication</div>
            <div class="tagbox" id="contraTags">
              <label class="tag red"><input type="checkbox" value="임신 가능성/임산부" />임신 가능성/임산부</label>
              <label class="tag red"><input type="checkbox" value="수유 중" />수유 중</label>
              <label class="tag red"><input type="checkbox" value="고혈압" />고혈압</label>
              <label class="tag red"><input type="checkbox" value="저혈압" />저혈압</label>
              <label class="tag red"><input type="checkbox" value="혈전/심혈관 질환" />혈전/심혈관 질환</label>
              <label class="tag red"><input type="checkbox" value="간/신장 질환" />간/신장 질환</label>
              <label class="tag red"><input type="checkbox" value="갑상선 질환" />갑상선 질환</label>
              <label class="tag red"><input type="checkbox" value="항우울제/수면제 복용" />항우울제/수면제 복용</label>
              <label class="tag red"><input type="checkbox" value="피부 알러지/민감성" />피부 알러지/민감성</label>
              <label class="tag red"><input type="checkbox" value="암/항암 치료 중/후" />암/항암 치료 중/후</label>
            </div>

            <div class="helper-box">
              주의 체크는 EO 선택 안전 가이드에 함께 반영됩니다. 실제 사용 여부·농도는 반드시 원장님이 최종 판단합니다.
            </div>

            <div class="divider"></div>

            <div class="card-title" style="font-size:16px">오늘 방문 목적 · 주요 컨디션 · 증상 선택</div>

            <div style="margin-top: 10px">
              <label>방문 목적 / 오늘 컨디션 메모</label>
              <textarea
                id="visitReason"
                placeholder="예) 골반통 + 생리 전 부종, 3일째 불면, 업무 스트레스로 어깨·목 결림..."
              ></textarea>
            </div>

            <div class="section-title">오늘 주요 증상 선택 (복수 선택 가능)</div>
            <div class="tagbox" id="symptomTags">
              <label class="tag green"><input type="checkbox" value="근육통/결림/요통" />근육통/결림/요통</label>
              <label class="tag green"><input type="checkbox" value="부종/림프정체" />부종/림프정체</label>
              <label class="tag green"><input type="checkbox" value="피로/무기력" />피로/무기력</label>
              <label class="tag green"><input type="checkbox" value="스트레스/불안" />스트레스/불안</label>
              <label class="tag green"><input type="checkbox" value="수면장애/불면" />수면장애/불면</label>
              <label class="tag green"><input type="checkbox" value="소화불량/위장" />소화불량/위장</label>
              <label class="tag green"><input type="checkbox" value="호르몬(PMS/갱년기)" />호르몬(PMS/갱년기)</label>
              <label class="tag green"><input type="checkbox" value="피부트러블/민감" />피부트러블/민감</label>
              <label class="tag green"><input type="checkbox" value="두통/집중저하/브레인" />두통/집중저하/브레인</label>
              <label class="tag green"><input type="checkbox" value="산후관리/골반·허리" />산후관리/골반·허리</label>
            </div>

            <div class="btn-row">
              <button class="btn btn-outline" onclick="updateEoGuideBySymptoms()">증상 기반 EO 추천 보기</button>
            </div>
          </div>

          <div style="height: 14px"></div>

          <div class="card">
            <div class="card-title">02. PROGRAM · PRICE · NEXT</div>
            <div class="card-caption">관리 프로그램 선택 · 회차권/금액권 관리 · 다음 방문 추천</div>

            <div class="divider"></div>

            <label>관리 프로그램 선택 *</label>
            <select id="programSelect"></select>

            <div class="divider"></div>

            <div class="card-title" style="font-size:16px">프로그램 금액 (총 정가 / 실제 결제)</div>
            <div class="grid2" style="margin-top: 10px">
              <div>
                <label>프로그램 정가 (총 정가 기준)</label>
                <input id="programListPriceInput" placeholder="예) 1800000" />
              </div>
              <div>
                <label>실제 결제 금액 (할인 적용 후)</label>
                <input id="programPaidPriceInput" placeholder="예) 1500000" />
              </div>
            </div>

            <div class="helper-box">
              프로그램 정가는 가격표 기준 총 정가, 실제 결제 금액은 고객이 실제 결제한 금액입니다.
              회차권/금액권 계산에는 실제 결제 금액을 기준으로 관리합니다.
            </div>

            <div class="divider"></div>

            <div class="section-title">권종 유형</div>
            <div class="tagbox">
              <label class="tag"><input type="radio" name="packageType" value="sessions" checked />회차권 (횟수 차감)</label>
              <label class="tag"><input type="radio" name="packageType" value="membership" />금액권 / 회원권 (잔액 차감)</label>
            </div>

            <div class="divider"></div>

            <div class="section-title">회차권 설정</div>
            <div class="grid2">
              <div>
                <label>1회 정가</label>
                <input id="sessionUnitPriceInput" placeholder="예) 180000" />
              </div>
              <div>
                <label>총 횟수</label>
                <input id="sessionTotalCountInput" placeholder="예) 10" />
              </div>
              <div>
                <label>사용 횟수 (오늘 방문 전까지)</label>
                <input id="sessionUsedCountInput" placeholder="예) 1" />
              </div>
              <div>
                <label>남은 횟수 / 다음 방문 추천일</label>
                <input id="nextVisitHint" placeholder="프로그램 intervalDays 기준으로 자동 계산됩니다." disabled />
              </div>
            </div>

            <div class="helper-box">
              회차권은 ‘횟수’, 회원권은 ‘잔액’ 기준으로 관리합니다.
              한 고객이 두 가지를 동시에 가지고 있어도, 오늘 어떤 기준으로 사용했는지만 정확히 기록하면 됩니다.
            </div>
          </div>

          <div style="height: 14px"></div>

          <div class="card">
            <div class="card-title">03. TODAY SESSION · RECIPE</div>
            <div class="card-caption">오늘 실제 시술 내용 · EO 실전 레시피(원장 판단) · 다음 계획</div>

            <div class="divider"></div>

            <label>오늘 실제 시술 내용 / 부위</label>
            <textarea id="sessionTechniques" placeholder="예) 온열뱀부 전신, 림프드레나지, 복부 온찜, 브레인 테라피 등"></textarea>

            <label style="margin-top: 12px">오늘 사용한 제품 (로블코코 / 엘라곰 / 기타)</label>
            <textarea id="sessionProducts" placeholder="예) 로블코코 00오일 + 엘라곰 바디오일, 홈케어 추천 등"></textarea>

            <label style="margin-top: 12px">EO 실전 레시피 (원장 전용 메모)</label>
            <textarea id="eoRecipeNote" placeholder="예) 마조람 3g + 제라늄 2g + 라벤더 3g ..."></textarea>

            <label style="margin-top: 12px">다음 회차/홈케어 계획 · 추천 안내</label>
            <textarea id="sessionNextPlan" placeholder="예) 1주 간격 3회 추가 권장, 홈케어는 ..."></textarea>

            <div class="btn-row">
              <button class="btn btn-outline" onclick="generateReportPreview()">자동 상담 리포트 미리보기</button>
              <button class="btn btn-outline" onclick="generateSummaryReport()">누적 상담 리포트 생성</button>
              <button class="btn btn-outline" onclick="loadLastSession()">최근 상담 불러오기</button>
              <button class="btn btn-primary" onclick="saveSession()">오늘 상담 내용 저장</button>
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div>
          <div class="card">
            <div class="card-header-row">
              <div>
                <div class="card-title">SYMPTOM-BASED EO GUIDE</div>
                <div class="card-caption">증상·주의사항에 맞춘 EO 효능 · 희석 · 주의점 안내</div>
              </div>
            </div>

            <div class="section-title">1) 증상 기반 EO 추천</div>
            <div id="eoRecommendations" class="muted">
              증상을 선택한 뒤 왼쪽의 “증상 기반 EO 추천 보기” 버튼을 눌러주세요.
            </div>

            <div class="divider"></div>

            <div class="section-title">2) 프로그램별 EO · 제품 추천</div>
            <div id="programRecommendations" class="muted">
              관리 프로그램을 선택하면, 해당 프로그램에 최적화된 EO 세트와 로블코코/엘라곰 제품 추천 리스트가 표시됩니다.
            </div>
          </div>

          <div style="height: 14px"></div>

          <div class="card">
            <div class="card-header-row">
              <div>
                <div class="card-title">자동 상담 리포트 · BEFORE/AFTER</div>
                <div class="card-caption">고객 설명용 리포트 + 세션별 전후 사진 기록</div>
              </div>
              <button class="btn btn-outline" onclick="downloadReportPdf()">리포트 PDF 다운로드</button>
            </div>

            <div class="section-title">자동 상담 리포트</div>
            <div id="reportPreview" class="photo-box" style="min-height: 160px">
              아직 리포트가 생성되지 않았습니다.<br />
              왼쪽 정보를 입력한 후 “자동 상담 리포트 미리보기” 버튼을 눌러주세요.
            </div>

            <div class="divider"></div>

            <div class="section-title">전후 사진 비교 (선택 사항 · 세션별 Before / After 저장)</div>
            <div class="photo-grid">
              <div class="photo-box">
                <div style="font-weight: 800">Before 사진</div>
                <input id="beforePhotoInput" type="file" accept="image/*" style="margin-top: 8px" />
                <div class="photo-preview">전후 비교를 위해 Before 사진을 업로드해 주세요.</div>
              </div>

              <div class="photo-box">
                <div style="font-weight: 800">After 사진</div>
                <input id="afterPhotoInput" type="file" accept="image/*" style="margin-top: 8px" />
                <div class="photo-preview">관리 후 After 사진을 업로드해 주세요.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /layout -->
    </div>
    <!-- /app-shell -->

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

    <!-- jsPDF for PDF download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Firebase 설정 & 앱 로직 -->
    <script src="./firebase-init.js"></script>
    <script src="./app.js"></script>
  </body>
</html>



